from glob import glob
from re import compile, DOTALL, M
from httplib import HTTPConnection
from shutil import move

pattern = compile(r'^---\s.*\bwordpress_id: (\d+)\b.*---', DOTALL|M)

post_ids = '''28008 28012 28102 28108 28113 28116 3319 3794 3795 3940 4167
    4426 5716 6507 7663 8452 8898 9183 9591 9702 9726 10365 10538 10880 11031
    11067 11319 11419 11309 11891 11919 11581 12550 7463 8725 12880 12976
    13271 13286 13295 11063 13802 13934 13110 14792 14852 14869 14872 15086
    15350 14963 16126 14175 17339 17826 18314 19064 20119 20493 20999 21257
    26307 25674 24712 25136 25362 24138 24006 23928 22154 23150 22701 22122
    22062 26899 27277 27353 25695 27755 22004 23120 23146 25310 28114 6599
    25921 2737 11991 14 53 191 241 274 283 289 298 332 545 732 766 899 1054
    1086 1148 1182 1202 1227 1251 1266 1320 1367 1395 1418 1423 1377 1461 1453
    1545 1706 1704 1770 1787 2726 2710 2749 2707 2718 2728 2743 2735 2716 2747
    2745 2720 2689 2712 1833 2724 2730 2823 2741 2739 3330 1966 2003 2023 2043
    2086 2124 2316 2405 2446 2598 3048 3050 3051 3052 3053 3063 3129 3244 3260
    3239 3321 3345 3426 3438 3556 3564 3599 3613 3674 3666 3645 3740 3715 3779
    3012 3702 3772 3835 3849 3861 3465 4308 3956 4047 3947 4072 4067 4079 4161
    4200 4099 4217 4059 4254 4316 4390 4028 4477 4507 4438 4559 4587 4569 4572
    4646 4637 4738 4722 4806 4782 4748 4824 4876 4912 4966 4970 5013 4935 5097
    5084 5121 5160 5148 5204 5386 5091 5322 5343 5467 5569 5517 5588 5610 5626
    5652 5701 5669 5735 5743 5464 5794 5724 5818 5931 5772 5968 5985 5994 6009
    6021 6041 6511 6586 6615 6663 6525 6516 6562 6762 6763 6764 7003 6828 7044
    7076 7085 7121 7107 7176 7093 7237 7338 7389 7117 7411 7398 7436 7530 7508
    7468 7566 7599 7702 7701 7741 7778 7806 7823 7670 7890 7922 7910 7931 8021
    8075 8049 8107 7957 8132 8089 8159 8013 8197 8171 8191 8147 8274 8038 8290
    8327 8343 8360 8417 8455 8471 8494 8513 8532 8583 8552 8643 8648 8772 8710
    8673 8613 8782 9037 8949 9094 9066 9373 9404 9421 9480 9474 9517 9527 9550
    9488 9499 9570 9482 9612 9620 9623 9644 9672 9655 9707 9828 9782 9952 9986
    9970 10026 10126 10166 10143 10281 10299 10096 10272 10389 10367 10387
    10566 10494 10579 10630 10549 10694 10647 10796 10834 10763 10860 10629
    10778 10757 10983 10868 11013 10994 11027 11076 11061 11190 11186 11334
    11137 11405 11114 11439 11461 11134 11366 11500 11598 11623 11662 11670
    11426 11701 11726 11297 11838 11723 11771 11824 11883 11915 11943 12143
    12180 12169 12212 12285 12263 11102 12260 12314 12359 12408 12584 12440
    12645 12332 12712 12724 12728 12672 12652 12723 12665 12804 12834 12868
    12785 12925 8803 13075 12979 13105 12959 13139 13195 13146 13228 13233
    13284 13169 13049 13346 13357 13465 13428 13319 13116 13558 13673 13715
    13693 13705 13767 13226 13868 13895 13632 12933 13596 14133 13923 14310
    13174 14473 13725 14496 14613 14586 13906 13747 14640 14670 14528 14902
    14895 13804 14933 13744 14981 14997 15038 14939 15069 13908 15159 15107
    15091 15285 15312 13621 15342 15212 15375 15394 15392 14815 15322 15567
    14727 15697 15521 15369 15423 15791 15180 15866 15911 15942 13940 15762
    15470 14871 16047 15602 16096 13765 16046 16309 16211 16396 16377 16352
    16462 16038 16490 16564 16529 16611 16635 16631 16552 16663 16706 15959
    16726 16755 16790 16575 17097 16967 16733 16839 17130 17139 16843 16025
    17190 17346 17342 17444 17465 17416 17602 16659 17968 18016 18133 17933
    18213 18288 18304 18196 18324 18374 18446 18442 17915 18468 17900 18563
    18599 18321 18140 18622 18626 15868 18759 18753 18706 18517 18783 18828
    18744 18913 18887 18945 18831 18971 18996 19036 19059 19052 19195 19188
    19250 19239 19291 19315 19309 19327 19429 19500 19360 19517 19329 19587
    19573 19600 19619 19354 19733 19808 19717 19837 19843 19715 19073 19924
    19907 20011 20042 19700 20057 20213 20237 20271 19614 20199 20370 20406
    20433 20440 20494 20521 20600 20558 20584 20511 20712 20539 20754 20764
    20818 20752 20867 20900 20980 20945 21141 21130 21175 21242 20737 21278
    21049 21308 21328 21378 21455 21465 21509 21515 21372 21382 21479 21480
    21556 21651 21667 21681 21632 21697 21746 21776 21822 21828 21878 21912
    21940 21987 22037 22083 22031 22064 22079 22162 22280 22427 22464 22503
    22560 22489 22451 22603 22470 22656 22541 22733 22630 22803 22835 22101
    22857 22781 22938 22972 22998 23013 23258 23315 23306 23348 23047 23452
    23557 23513 23571 23730 23088 23106 23501 23135 23115 23943 23988 23794
    24112 24099 24142 24089 24017 24105 24266 22930 24317 23082 23067 24466
    24285 24434 24374 24547 24569 24343 24512 22675 24265 24677 24722 24847
    24869 24990 24842 24863 24867 24861 22671 25138 21630 25286 25291 23266
    25393 25384 25433 25429 25448 25565 25202 24809 25867 22647 25877 25678
    25908 25676 26177 26270 26319 26336 26407 26490 21853 26871 26741 27225
    27238 27251 27228 27364 27392 27355 27431 27444 22514 27461 27424 27567
    24427 23127 23055 23031 27597 23143 23043 23039 23139 23060 27662 23100
    23076 23109 27777 27759 27765 27821 27916 27934 27991 27858 27731'''

post_ids = set(post_ids.split())
print len(post_ids), 'post IDs'

for filename in glob('_posts/*.markdown'):
    with open(filename) as file:
        data = file.read()
        match = pattern.match(data)
        
        if not match:
            print 'no', filename
            exit(1)
        
        wp_id = match.group(1)
        
        if wp_id in post_ids:
            post_ids.remove(wp_id)
        
        else:
            print 'moving', filename
            move(filename, '_pages/')

print len(post_ids), 'unmatched post IDs'

for post_id in list(post_ids):
    conn = HTTPConnection('codeforamerica.org')
    conn.request('HEAD', '/?p=' + post_id)
    resp = conn.getresponse()
    
    if resp.status == 404:
        print post_id, 'is 404'
        post_ids.remove(post_id)

print len(post_ids), 'unaccounted-for post IDs:', ', '.join(post_ids)
